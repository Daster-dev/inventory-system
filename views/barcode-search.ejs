<%- include('partials/header') %>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    #scanner { width: 300px; margin: 20px auto; display: none; }
    .product { border: 1px solid #ccc; padding: 10px; margin: 10px; }
    button { margin: 10px; padding: 10px; font-size: 16px; }
  </style>
  
  <h2>🔍 بحث باستخدام الباركود</h2>

  <button onclick="startScanner()">📷 امسح الباركود</button>

  <div id="scanner"></div>

  <% if (product) { %>
  
      <div class="product-card 
  <% if (product.qty === 0) { %> out <% } 
     else if (product.qty < 5) { %> low <% } 
     else { %> ok <% } %>" data-name="<%= product.name.toLowerCase() %>">
  <% if (product.imgPath) { %>
    <img src="<%= product.imgPath %>" alt="<%= product.name %>" id="imgClick">
  <% } %>
  <h3><%= product.name %></h3>
  <p>القسم: <strong><%= product.category %></strong></p>
  <p>الكمية: <%= product.qty %></p>

  <button class="sell-btn" data-id="<%= product.id %>">تم البيع</button>

  <form action="/products/delete/<%= product.id %>" method="POST" style="margin-top:5px;" onsubmit="return confirm('⚠️ هل أنت متأكد من حذف المنتج؟');">
    <button type="submit" class="del-btn" style="background:#c00; color:#fff;">🗑 حذف المنتج</button>
  </form>


</div>
	
  <% } %>

  
  
  
  
  
  
  
  
  <script>
    let scanner;
    function startScanner() {
      document.getElementById("scanner").style.display = "block";
      scanner = new Html5Qrcode("scanner");
      scanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        (decodedText) => {
          scanner.stop();
          window.location.href = `/barcode-result?code=${decodedText}`;
        },
        (errorMessage) => {
          console.warn("خطأ بالقراءة:", errorMessage);
        }
      );
    }

    function restartScanner() {
      if (scanner) {
        scanner.stop().then(() => {
          document.getElementById("scanner").innerHTML = "";
          startScanner();
        });
      } else {
        startScanner();
      }
    }
  </script>
  
  
  
  
  <%- include('partials/footer') %>
