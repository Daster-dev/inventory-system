<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ุจุญุซ ุจุงูุจุงุฑููุฏ</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    #scanner { width: 300px; margin: 20px auto; display: none; }
    .product { border: 1px solid #ccc; padding: 10px; margin: 10px; }
    button { margin: 10px; padding: 10px; font-size: 16px; }
  </style>
</head>
<body>
  <h2>๐ ุจุญุซ ุจุงุณุชุฎุฏุงู ุงูุจุงุฑููุฏ</h2>

  <button onclick="startScanner()">๐ท ุงูุณุญ ุงูุจุงุฑููุฏ</button>
  <button onclick="restartScanner()">๐ ุฅุนุงุฏุฉ ุงููุณุญ</button>
  <div id="scanner"></div>

  <% if (product) { %>
    <div class="product">
      <h3><%= product.name %></h3>
      <p>ุงูุณุนุฑ: <%= product.priceOut %> ุฏููุงุฑ</p>
      <p>ุงูุจุงุฑููุฏ: <%= product.barcode %></p>
	  <button data-id="<%= product.id %>" class"sell-btn">ุจูุน ุงูููุชุฌ</button> 
    </div>
  <% } %>

  <script>
    let scanner;
    function startScanner() {
      document.getElementById("scanner").style.display = "block";
      scanner = new Html5Qrcode("scanner");
      scanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        (decodedText) => {
          scanner.stop();
          window.location.href = `/barcode-result?code=${decodedText}`;
        },
        (errorMessage) => {
          console.warn("ุฎุทุฃ ุจุงููุฑุงุกุฉ:", errorMessage);
        }
      );
    }

    function restartScanner() {
      if (scanner) {
        scanner.stop().then(() => {
          document.getElementById("scanner").innerHTML = "";
          startScanner();
        });
      } else {
        startScanner();
      }
    }
  </script>
</body>
</html>
