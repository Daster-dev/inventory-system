<%- include('partials/header') %>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    #scanner { width: 300px; margin: 20px auto; display: none; }
    .product { border: 1px solid #ccc; padding: 10px; margin: 10px; }
    button { margin: 10px; padding: 10px; font-size: 16px; }
  </style>
  
  <h2>ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</h2>

  <button onclick="startScanner()">ğŸ“· Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
  <button onclick="restartScanner()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³Ø­</button>
  <div id="scanner"></div>

  <% if (product) { %>
    <div class="product">
      <h3><%= product.name %></h3>
      <p>Ø§Ù„Ø³Ø¹Ø±: <%= product.priceOut %> Ø¯ÙŠÙ†Ø§Ø±</p>
      <p>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: <%= product.barcode %></p>
	  <button data-id="<%= product.id %>" class"sell-btn">Ø¨ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬</button> 
    </div>
  <% } %>

  <script>
    let scanner;
    function startScanner() {
      document.getElementById("scanner").style.display = "block";
      scanner = new Html5Qrcode("scanner");
      scanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        (decodedText) => {
          scanner.stop();
          window.location.href = `/barcode-result?code=${decodedText}`;
        },
        (errorMessage) => {
          console.warn("Ø®Ø·Ø£ Ø¨Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©:", errorMessage);
        }
      );
    }

    function restartScanner() {
      if (scanner) {
        scanner.stop().then(() => {
          document.getElementById("scanner").innerHTML = "";
          startScanner();
        });
      } else {
        startScanner();
      }
    }
  </script>
  
  
  
  
  <%- include('partials/footer') %>
